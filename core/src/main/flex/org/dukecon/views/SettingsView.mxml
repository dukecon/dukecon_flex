<?xml version="1.0"?>
<!--
  Created by christoferdutz on 14.07.15.
-->
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
        xmlns:s="library://ns.adobe.com/flex/spark"
        xmlns:parsley="http://www.spicefactory.org/parsley"
        title="{resourceManager.getString('dukecon', 'settings.title')}"
        creationComplete="onCreationComplete(event)">

    <fx:Metadata>
        [ResourceBundle("dukecon")]
    </fx:Metadata>

    <fx:Declarations>
        <parsley:Configure/>
        <s:RadioButtonGroup id="languageGroup" change="onLanguageChange(event)"/>
    </fx:Declarations>

    <s:navigationContent>
        <s:Button label="&lt;" click="onBackClicked(event)"/>
    </s:navigationContent>

    <fx:Script>


        import mx.events.FlexEvent;

        import org.dukecon.controller.SettingsController;

        [Inject]
        public var settingsController:SettingsController;

        protected function onCreationComplete(event:FlexEvent):void {
            // Hide the settings action button.
            for each(var button:Button in navigator.actionContent) {
                if (button.name == "settingsButton") {
                    button.visible = false;
                }
            }
        }


        override protected function commitProperties():void {
            super.commitProperties();

            // Select the currently selected locale button.
            if (resourceManager.localeChain[0] == "en_US") {
                englishButton.selected = true;
            } else {
                germanButton.selected = true;
            }

            // Hide the button that currently should not be displayed.
            if (settingsController.serverAccount) {
                bindButton.visible = false;
                unbindButton.visible = true;
            } else {
                bindButton.visible = true;
                unbindButton.visible = false;
            }
            bindButton.includeInLayout = bindButton.visible;
            unbindButton.includeInLayout = unbindButton.visible;
        }

        protected function onBackClicked(event:MouseEvent):void {
            // Un-hide the settings action button.
            for each(var button:Button in navigator.actionContent) {
                if (button.name == "settingsButton") {
                    button.visible = true;
                }
            }
            navigator.popView()
        }

        protected function onLanguageChange(event:Event):void {
            resourceManager.localeChain = [languageGroup.selectedValue];
            settingsController.selectedLanguage = String(languageGroup.selectedValue);
        }

        protected function onBindClicked(event:MouseEvent):void {

        }

        protected function onUnbindClicked(event:MouseEvent):void {
            settingsController.serverAccount = null;
        }

    </fx:Script>

    <s:Form width="100%">
        <s:FormItem label="{resourceManager.getString('dukecon', 'settings.language')}:" width="300">
            <s:RadioButton id="englishButton" groupName="languageGroup" label="English" value="en_US"/>
            <s:RadioButton id="germanButton" groupName="languageGroup" label="Deutsch" value="de_DE"/>
        </s:FormItem>
        <s:FormItem label="{resourceManager.getString('dukecon', 'settings.server-account')}:" width="300">
            <s:Button id="bindButton" label="{resourceManager.getString('dukecon', 'settings.server-account.bind')}"
                      click="onBindClicked(event)" width="100%"/>
            <s:Button id="unbindButton" label="{resourceManager.getString('dukecon', 'settings.server-account.unbind')}"
                      click="onUnbindClicked(event)" width="100%"/>
        </s:FormItem>
    </s:Form>

</s:View>
